---
layout: post
title: ã€è¯‘ã€‘ç”¨Javaåˆ›å»ºä½ çš„ç¬¬ä¸€ä¸ªåŒºå—é“¾-part1
categories: åŒºå—é“¾
description: åŒºå—é“¾
keywords: åŒºå—é“¾
---
> åŒºå—é“¾æ˜¯åˆ†å¸ƒå¼æ•°æ®å­˜å‚¨ã€ç‚¹å¯¹ç‚¹ä¼ è¾“ã€å…±è¯†æœºåˆ¶ã€åŠ å¯†ç®—æ³•ç­‰è®¡ç®—æœºæŠ€æœ¯çš„æ–°å‹åº”ç”¨æ¨¡å¼ã€‚æ‰€è°“å…±è¯†æœºåˆ¶æ˜¯åŒºå—é“¾ç³»ç»Ÿä¸­å®ç°ä¸åŒèŠ‚ç‚¹ä¹‹é—´å»ºç«‹ä¿¡ä»»ã€è·å–æƒç›Šçš„æ•°å­¦ç®—æ³•  ã€‚

## å‰è¨€
æœ¬ç³»åˆ—æ•™ç¨‹æ—¨åœ¨å¸®åŠ©ä½ äº†è§£å¦‚ä½•å¼€å‘åŒºå—é“¾æŠ€æœ¯ã€‚

**æœ¬ç« ç›®æ ‡**

- åˆ›å»ºä½ ç¬¬ä¸€ä¸ªéå¸¸åŸºæœ¬çš„åŒºå—é“¾
- å®ç°ä¸€ä¸ªç®€å•çš„å·¥ä½œé‡è¯æ˜ç³»ç»Ÿå³æŒ–çŸ¿
- åœ¨æ­¤åŸºç¡€ä¸Šè¿›è¡Œæ‰©å±•

ï¼ˆæˆ‘ä¼šå‡è®¾ä½ å¯¹é¢å‘å¯¹è±¡ç¼–ç¨‹æœ‰åŸºæœ¬çš„äº†è§£ï¼‰

*å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œåˆ›å»ºçš„åŒºå—é“¾å¹¶ä¸æ˜¯åŠŸèƒ½å®Œå…¨çš„å®Œå…¨é€‚åˆåº”ç”¨ä¸ç”Ÿäº§çš„åŒºå—é“¾ï¼Œç›¸ååªæ˜¯ä¸ºäº†å¸®åŠ©ä½ æ›´å¥½çš„ç†è§£åŒºå—é“¾çš„æ¦‚å¿µã€‚*

[![https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/qukuai/qukuai01.gif](https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/qukuai/qukuai01.gif "https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/qukuai/qukuai01.gif")](https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/qukuai/qukuai01.gif "https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/qukuai/qukuai01.gif")

### åˆ›å»ºåŒºå—é“¾
åŒºå—é“¾å°±æ˜¯ä¸€ä¸²æˆ–è€…æ˜¯ä¸€ç³»åˆ—åŒºå—çš„é›†åˆï¼Œç±»ä¼¼äºé“¾è¡¨çš„æ¦‚å¿µï¼Œæ¯ä¸ªåŒºå—éƒ½æŒ‡å‘äºåé¢ä¸€ä¸ªåŒºå—ï¼Œç„¶åé¡ºåºçš„è¿æ¥åœ¨ä¸€èµ·ã€‚é‚£ä¹ˆæ¯ä¸ªåŒºå—ä¸­çš„å†…å®¹æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿåœ¨åŒºå—é“¾ä¸­çš„æ¯ä¸€ä¸ªåŒºå—éƒ½å­˜æ”¾äº†å¾ˆå¤šå¾ˆæœ‰ä»·å€¼çš„ä¿¡æ¯ï¼Œä¸»è¦åŒ…æ‹¬ä¸‰ä¸ªéƒ¨åˆ†ï¼šè‡ªå·±çš„æ•°å­—ç­¾åï¼Œä¸Šä¸€ä¸ªåŒºå—çš„æ•°å­—ç­¾åï¼Œè¿˜æœ‰ä¸€åˆ‡éœ€è¦åŠ å¯†çš„æ•°æ®ï¼ˆè¿™äº›æ•°æ®åœ¨æ¯”ç‰¹å¸ä¸­å°±ç›¸å½“äºæ˜¯äº¤æ˜“çš„ä¿¡æ¯ï¼Œå®ƒæ˜¯åŠ å¯†è´§å¸çš„æœ¬è´¨ï¼‰ã€‚æ¯ä¸ªæ•°å­—ç­¾åä¸ä½†è¯æ˜äº†è‡ªå·±æ˜¯ç‰¹æœ‰çš„ä¸€ä¸ªåŒºå—ï¼Œè€Œä¸”æŒ‡å‘äº†å‰ä¸€ä¸ªåŒºå—çš„æ¥æºï¼Œè®©æ‰€æœ‰çš„åŒºå—åœ¨é“¾æ¡ä¸­å¯ä»¥ä¸²èµ·æ¥ï¼Œè€Œæ•°æ®å°±æ˜¯ä¸€äº›ç‰¹å®šçš„ä¿¡æ¯ï¼Œä½ å¯ä»¥æŒ‰ç…§ä¸šåŠ¡é€»è¾‘æ¥ä¿å­˜ä¸šåŠ¡æ•°æ®ã€‚

[![https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/qukuai/qukuai01.png](https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/qukuai/qukuai01.png "https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/qukuai/qukuai01.png")](https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/qukuai/qukuai01.png "https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/qukuai/qukuai01.png")

**è¿™é‡Œçš„hashæŒ‡çš„å°±æ˜¯æ•°å­—ç­¾å**

**æ‰€ä»¥æ¯ä¸€ä¸ªåŒºå—ä¸ä»…åŒ…å«å‰ä¸€ä¸ªåŒºå—çš„hashå€¼ï¼ŒåŒæ—¶åŒ…å«è‡ªèº«çš„ä¸€ä¸ªhashå€¼**ï¼Œè‡ªèº«çš„hashå€¼æ˜¯é€šè¿‡ä¹‹å‰çš„hashå€¼å’Œæ•°æ®dateé€šè¿‡hashè®¡ç®—å‡ºæ¥çš„ã€‚å¦‚æœå‰ä¸€ä¸ªåŒºå—çš„æ•°æ®ä¸€æ—¦è¢«ç¯¡æ”¹äº†ï¼Œé‚£ä¹ˆå‰ä¸€ä¸ªåŒºå—çš„hashå€¼ä¹Ÿä¼šåŒæ ·å‘ç”Ÿå˜åŒ–ï¼ˆå› ä¸ºæ•°æ®ä¹Ÿè¢«è®¡ç®—åœ¨å†…ï¼‰ï¼Œè¿™æ ·ä¹Ÿå°±å¯¼è‡´äº†æ‰€æœ‰åç»­çš„åŒºå—ä¸­çš„hashå€¼ã€‚**æ‰€ä»¥è®¡ç®—å’Œæ¯”å¯¹hashå€¼ä¼šè®©æˆ‘ä»¬æ£€æŸ¥åˆ°å½“å‰çš„åŒºå—é“¾æ˜¯å¦æ˜¯æœ‰æ•ˆçš„**ï¼Œä¹Ÿå°±é¿å…äº†æ•°æ®è¢«æ¶æ„ç¯¡æ”¹çš„å¯èƒ½æ€§ï¼Œå› ä¸ºç¯¡æ”¹æ•°æ®å°±ä¼šæ”¹å˜hashå€¼å¹¶ç ´åæ•´ä¸ªåŒºå—é“¾ã€‚

####å®šä¹‰åŒºå—é“¾çš„ç±»å¿«
```java
import java.util.Date;

public class Block {

	public String hash;
	public String previousHash;
	private String data; //our data will be a simple message.
	private long timeStamp; //as number of milliseconds since 1/1/1970.

	//Block Constructor.
	public Block(String data,String previousHash ) {
		this.data = data;
		this.previousHash = previousHash;
		this.timeStamp = new Date().getTime();
	}
}
```

æ­£å¦‚ä½ å¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„åŸºæœ¬å—åŒ…å«`String hash`ï¼Œå®ƒå°†ä¿å­˜æˆ‘ä»¬çš„æ•°å­—ç­¾åã€‚å˜é‡`previoushash`ä¿å­˜å‰ä¸€ä¸ªå—çš„`hash`å’Œ`String data`æ¥ä¿å­˜æˆ‘ä»¬çš„å—æ•°æ®

#### åˆ›å»ºæ•°å­—ç­¾å

ç†Ÿæ‚‰åŠ å¯†ç®—æ³•çš„æœ‹å‹ä»¬ï¼ŒJavaæ–¹å¼å¯ä»¥å®ç°çš„åŠ å¯†æ–¹å¼æœ‰å¾ˆå¤šï¼Œä¾‹å¦‚BASEã€MDã€RSAã€SHAç­‰ç­‰ï¼Œæˆ‘åœ¨è¿™é‡Œé€‰ç”¨äº†SHA256è¿™ç§åŠ å¯†æ–¹å¼ï¼ŒSHAï¼ˆSecure Hash Algorithmï¼‰å®‰å…¨æ•£åˆ—ç®—æ³•ï¼Œè¿™ç§ç®—æ³•çš„ç‰¹ç‚¹æ˜¯æ•°æ®çš„å°‘é‡æ›´æ”¹ä¼šåœ¨Hashå€¼ä¸­äº§ç”Ÿä¸å¯é¢„çŸ¥çš„å¤§é‡æ›´æ”¹ï¼Œhashå€¼ç”¨ä½œè¡¨ç¤ºå¤§é‡æ•°æ®çš„å›ºå®šå¤§å°çš„å”¯ä¸€å€¼ï¼Œè€ŒSHA256ç®—æ³•çš„hashå€¼å¤§å°ä¸º256ä½ã€‚ä¹‹æ‰€ä»¥é€‰ç”¨SHA256æ˜¯å› ä¸ºå®ƒçš„å¤§å°æ­£åˆé€‚ï¼Œä¸€æ–¹é¢äº§ç”Ÿé‡å¤hashå€¼çš„å¯èƒ½æ€§å¾ˆå°ï¼Œå¦ä¸€æ–¹é¢åœ¨åŒºå—é“¾å®é™…åº”ç”¨è¿‡ç¨‹ä¸­ï¼Œæœ‰å¯èƒ½ä¼šäº§ç”Ÿå¤§é‡çš„åŒºå—ï¼Œè€Œä½¿å¾—ä¿¡æ¯é‡å¾ˆå¤§ï¼Œé‚£ä¹ˆ256ä½çš„å¤§å°å°±æ¯”è¾ƒæ°å½“äº†ã€‚

ä¸‹é¢æˆ‘åˆ›å»ºäº†ä¸€ä¸ªStringUtilæ–¹æ³•æ¥æ–¹ä¾¿è°ƒç”¨SHA256ç®—æ³•

```java
import java.security.MessageDigest;

public class StringUtil {
	//Applies Sha256 to a string and returns the result. 
	public static String applySha256(String input){		
		try {
			MessageDigest digest = MessageDigest.getInstance("SHA-256");	        
			//Applies sha256 to our input, 
			byte[] hash = digest.digest(input.getBytes("UTF-8"));	        
			StringBuffer hexString = new StringBuffer(); // This will contain hash as hexidecimal
			for (int i = 0; i < hash.length; i++) {
				String hex = Integer.toHexString(0xff & hash[i]);
				if(hex.length() == 1) hexString.append('0');
				hexString.append(hex);
			}
			return hexString.toString();
		}
		catch(Exception e) {
			throw new RuntimeException(e);
		}
	}	
}
```

æˆ–è®¸ä½ å®Œå…¨ä¸ç†è§£ä¸Šè¿°ä»£ç çš„å«ä¹‰ï¼Œä½†æ˜¯ä½ åªè¦ç†è§£æ‰€æœ‰çš„è¾“å…¥è°ƒç”¨æ­¤æ–¹æ³•åå‡ä¼šç”Ÿæˆä¸€ä¸ªç‹¬ä¸€æ— äºŒçš„hashå€¼ï¼ˆæ•°å­—ç­¾åï¼‰ï¼Œè€Œè¿™ä¸ªhashå€¼åœ¨åŒºå—é“¾ä¸­æ˜¯éå¸¸é‡è¦çš„ã€‚

æ¥ä¸‹æ¥è®©æˆ‘ä»¬åœ¨Blockç±»ä¸­åº”ç”¨ æ–¹æ³• applySha256 æ–¹æ³•ï¼Œå…¶ä¸»è¦çš„ç›®çš„å°±æ˜¯è®¡ç®—hashå€¼ï¼Œæˆ‘ä»¬è®¡ç®—çš„hashå€¼åº”è¯¥åŒ…æ‹¬åŒºå—ä¸­æ‰€æœ‰æˆ‘ä»¬ä¸å¸Œæœ›è¢«æ¶æ„ç¯¡æ”¹çš„æ•°æ®ï¼Œåœ¨æˆ‘ä»¬ä¸Šé¢æ‰€åˆ—çš„Blockç±»ä¸­å°±ä¸€å®šåŒ…æ‹¬previousHashï¼Œdataå’ŒtimeStampï¼Œ

```java
public String calculateHash() {
	String calculatedhash = StringUtil.applySha256( 
			previousHash +
			Long.toString(timeStamp) +
			data 
			);
	return calculatedhash;
}
```
ç„¶åæŠŠè¿™ä¸ªæ–¹æ³•åŠ å…¥åˆ°Blockçš„æ„é€ å‡½æ•°ä¸­å»
```java
public Block(String data,String previousHash ) {
		this.data = data;
		this.previousHash = previousHash;
		this.timeStamp = new Date().getTime();
		this.hash = calculateHash(); //Making sure we do this after we set the other values.
	}
```

#### æµ‹è¯•
åœ¨ä¸»æ–¹æ³•ä¸­è®©æˆ‘ä»¬åˆ›å»ºä¸€äº›åŒºå—ï¼Œå¹¶æŠŠå…¶hashå€¼æ‰“å°å‡ºæ¥ï¼Œæ¥çœ‹çœ‹æ˜¯å¦ä¸€åˆ‡éƒ½åœ¨æˆ‘ä»¬çš„æŒæ§ä¸­ã€‚

[![https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/qukuai/qukuai.gif](https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/qukuai/qukuai.gif "https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/qukuai/qukuai.gif")](https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/qukuai/qukuai.gif "https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/qukuai/qukuai.gif")


ç¬¬ä¸€ä¸ªå—ç§°ä¸ºåˆ›ä¸–çºªåŒºå—ï¼Œå› ä¸ºå®ƒæ˜¯å¤´åŒºå—ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¾“å…¥â€œ0â€ä½œä¸ºå‰ä¸€ä¸ªå—çš„`previous hash`ã€‚

```java
public class NoobChain {

	public static void main(String[] args) {
		
		Block genesisBlock = new Block("Hi im the first block", "0");
		System.out.println("Hash for block 1 : " + genesisBlock.hash);
		
		Block secondBlock = new Block("Yo im the second block",genesisBlock.hash);
		System.out.println("Hash for block 2 : " + secondBlock.hash);
		
		Block thirdBlock = new Block("Hey im the third block",secondBlock.hash);
		System.out.println("Hash for block 3 : " + thirdBlock.hash);
		
	}
}
```

æ‰“å°ï¼š
```java
Hash for block 1: f6d1bc5f7b0016eab53ec022db9a5d9e1873ee78513b1c666696e66777fe55fb
Hash for block 2: 6936612b3380660840f22ee6cb8b72ffc01dbca5369f305b92018321d883f4a3
Hash for block 3: f3e58f74b5adbd59a7a1fc68c97055d42e94d33f6c322d87b29ab20d3c959b8f
```

æ¯ä¸€ä¸ªåŒºå—éƒ½å¿…é¡»è¦æœ‰è‡ªå·±çš„æ•°æ®ç­¾åå³hashå€¼ï¼Œè¿™ä¸ªhashå€¼ä¾èµ–äºè‡ªèº«çš„ä¿¡æ¯ï¼ˆdataï¼‰å’Œä¸Šä¸€ä¸ªåŒºå—çš„æ•°å­—ç­¾åï¼ˆpreviousHashï¼‰ï¼Œä½†è¿™ä¸ªè¿˜ä¸æ˜¯åŒºå—é“¾ï¼Œä¸‹é¢è®©æˆ‘ä»¬å­˜å‚¨åŒºå—åˆ°æ•°ç»„ä¸­ï¼Œè¿™é‡Œæˆ‘ä¼šå¼•å…¥gsonåŒ…ï¼Œç›®çš„æ˜¯å¯ä»¥ç”¨jsonæ–¹å¼æŸ¥çœ‹æ•´ä¸ªä¸€æ¡åŒºå—é“¾ç»“æ„ã€‚

```java

import java.util.ArrayList;
import com.google.gson.GsonBuilder;

public class NoobChain {
	
	public static ArrayList<Block> blockchain = new ArrayList<Block>(); 

	public static void main(String[] args) {	
		//add our blocks to the blockchain ArrayList:
		blockchain.add(new Block("Hi im the first block", "0"));		
		blockchain.add(new Block("Yo im the second block",blockchain.get(blockchain.size()-1).hash)); 
		blockchain.add(new Block("Hey im the third block",blockchain.get(blockchain.size()-1).hash));
		
		String blockchainJson = new GsonBuilder().setPrettyPrinting().create().toJson(blockchain);		
		System.out.println(blockchainJson);
	}

}
```

è¿™æ ·çš„è¾“å‡ºç»“æ„å°±æ›´ç±»ä¼¼äºæˆ‘ä»¬æ‰€æœŸå¾…çš„åŒºå—é“¾çš„æ ·å­ã€‚

#### æ£€æŸ¥åŒºå—é“¾çš„å®Œæ•´æ€§

åœ¨ä¸»æ–¹æ³•ä¸­å¢åŠ ä¸€ä¸ªisChainValid()æ–¹æ³•ï¼Œç›®çš„æ˜¯å¾ªç¯åŒºå—é“¾ä¸­çš„æ‰€æœ‰åŒºå—å¹¶ä¸”æ¯”è¾ƒhashå€¼ï¼Œè¿™ä¸ªæ–¹æ³•ç”¨æ¥æ£€æŸ¥hashå€¼æ˜¯å¦æ˜¯äºè®¡ç®—å‡ºæ¥çš„hashå€¼ç›¸ç­‰ï¼ŒåŒæ—¶previousHashå€¼æ˜¯å¦å’Œå‰ä¸€ä¸ªåŒºå—çš„hashå€¼ç›¸ç­‰ã€‚æˆ–è®¸ä½ ä¼šäº§ç”Ÿå¦‚ä¸‹çš„ç–‘é—®ï¼Œæˆ‘ä»¬å°±åœ¨ä¸€ä¸ªä¸»å‡½æ•°ä¸­åˆ›å»ºåŒºå—é“¾ä¸­çš„åŒºå—ï¼Œæ‰€ä»¥ä¸å­˜åœ¨è¢«ä¿®æ”¹çš„å¯èƒ½æ€§ï¼Œä½†æ˜¯ä½ è¦æ³¨æ„çš„æ˜¯ï¼ŒåŒºå—é“¾ä¸­çš„ä¸€ä¸ªæ ¸å¿ƒæ¦‚å¿µå°±æ˜¯å»ä¸­å¿ƒåŒ–ï¼Œæ¯ä¸€ä¸ªåŒºå—å¯èƒ½æ˜¯åœ¨ç½‘ç»œä¸­çš„æŸä¸€ä¸ªèŠ‚ç‚¹ä¸­äº§ç”Ÿçš„ï¼Œæ‰€ä»¥å¾ˆæœ‰å¯èƒ½æŸä¸ªèŠ‚ç‚¹æŠŠè‡ªå·±èŠ‚ç‚¹ä¸­çš„æ•°æ®ä¿®æ”¹äº†ï¼Œé‚£ä¹ˆæ ¹æ®ä¸Šè¿°çš„ç†è®ºæ•°æ®æ”¹å˜ä¼šå¯¼è‡´æ•´ä¸ªåŒºå—é“¾çš„ç ´è£‚ï¼Œä¹Ÿå°±æ˜¯åŒºå—é“¾å°±æ— æ•ˆäº†ã€‚

```java
public static Boolean isChainValid() {
	Block currentBlock; 
	Block previousBlock;
	
	//loop through blockchain to check hashes:
	for(int i=1; i < blockchain.size(); i++) {
		currentBlock = blockchain.get(i);
		previousBlock = blockchain.get(i-1);
		//compare registered hash and calculated hash:
		if(!currentBlock.hash.equals(currentBlock.calculateHash()) ){
			System.out.println("Current Hashes not equal");			
			return false;
		}
		//compare previous hash and registered previous hash
		if(!previousBlock.hash.equals(currentBlock.previousHash) ) {
			System.out.println("Previous Hashes not equal");
			return false;
		}
	}
	return true;
}
```

ä»»ä½•åŒºå—é“¾ä¸­åŒºå—çš„ä¸€ä¸ä¸€æ¯«æ”¹å˜éƒ½ä¼šå¯¼è‡´è¿™ä¸ªå‡½æ•°è¿”å›falseï¼Œä¹Ÿå°±è¯æ˜äº†åŒºå—é“¾æ— æ•ˆäº†ã€‚

åœ¨æ¯”ç‰¹å¸ç½‘ç»œä¸­æ‰€æœ‰çš„ç½‘ç»œèŠ‚ç‚¹éƒ½åˆ†äº«äº†å®ƒä»¬å„è‡ªçš„åŒºå—é“¾ï¼Œç„¶è€Œæœ€é•¿çš„æœ‰æ•ˆåŒºå—é“¾æ˜¯è¢«å…¨ç½‘æ‰€ç»Ÿä¸€æ‰¿è®¤çš„ï¼Œå¦‚æœæœ‰äººæ¶æ„æ¥ç¯¡æ”¹ä¹‹å‰çš„æ•°æ®ï¼Œç„¶ååˆ›å»ºä¸€æ¡æ›´é•¿çš„åŒºå—é“¾å¹¶å…¨ç½‘å‘å¸ƒå‘ˆç°åœ¨ç½‘ç»œä¸­ï¼Œæˆ‘ä»¬è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿè¿™å°±æ¶‰åŠåˆ°äº†åŒºå—é“¾ä¸­å¦å¤–ä¸€ä¸ªé‡è¦çš„æ¦‚å¿µå·¥ä½œé‡è¯æ˜ï¼Œè¿™é‡Œå°±ä¸å¾—ä¸æåŠä¸€ä¸‹hashcashï¼Œè¿™ä¸ªæ¦‚å¿µæœ€æ—©æ¥è‡ªäºAdam Backçš„ä¸€ç¯‡è®ºæ–‡ï¼Œä¸»è¦åº”ç”¨äºé‚®ä»¶è¿‡æ»¤å’Œæ¯”ç‰¹å¸ä¸­é˜²æ­¢åŒé‡æ”¯ä»˜ã€‚

[![https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/qukuai/qukuai02.png](https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/qukuai/qukuai02.png "https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/qukuai/qukuai02.png")](https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/qukuai/qukuai02.png "https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/qukuai/qukuai02.png")

### æŒ–çŸ¿

è¿™é‡Œæˆ‘ä»¬è¦æ±‚æŒ–çŸ¿è€…åšå·¥ä½œé‡è¯æ˜ï¼Œå…·ä½“çš„æ–¹å¼æ˜¯åœ¨åŒºå—ä¸­å°è¯•ä¸åŒçš„å‚æ•°å€¼ç›´åˆ°å®ƒçš„hashå€¼æ˜¯ä»ä¸€ç³»åˆ—çš„0å¼€å§‹çš„ã€‚è®©æˆ‘ä»¬æ·»åŠ ä¸€ä¸ªåä¸º`nonce`çš„intç±»å‹ä»¥åŒ…å«åœ¨æˆ‘ä»¬çš„`calculatehashï¼ˆï¼‰`æ–¹æ³•ä¸­ï¼Œä»¥åŠéœ€è¦çš„`mineblockï¼ˆï¼‰`æ–¹æ³•

```java
import java.util.Date;

public class Block {
	
	public String hash;
	public String previousHash; 
	private String data; //our data will be a simple message.
	private long timeStamp; //as number of milliseconds since 1/1/1970.
	private int nonce;
	
	//Block Constructor.  
	public Block(String data,String previousHash ) {
		this.data = data;
		this.previousHash = previousHash;
		this.timeStamp = new Date().getTime();
		
		this.hash = calculateHash(); //Making sure we do this after we set the other values.
	}
	
	//Calculate new hash based on blocks contents
	public String calculateHash() {
		String calculatedhash = StringUtil.applySha256( 
				previousHash +
				Long.toString(timeStamp) +
				Integer.toString(nonce) + 
				data 
				);
		return calculatedhash;
	}
	
	public void mineBlock(int difficulty) {
		String target = new String(new char[difficulty]).replace('\0', '0'); //Create a string with difficulty * "0" 
		while(!hash.substring( 0, difficulty).equals(target)) {
			nonce ++;
			hash = calculateHash();
		}
		System.out.println("Block Mined!!! : " + hash);
	}
}
```
 mineBlock()æ–¹æ³•ä¸­å¼•å…¥äº†ä¸€ä¸ªintå€¼ç§°ä¸ºdifficultyéš¾åº¦ï¼Œä½çš„éš¾åº¦æ¯”å¦‚1å’Œ2ï¼Œæ™®é€šçš„ç”µè„‘åŸºæœ¬éƒ½å¯ä»¥é©¬ä¸Šè®¡ç®—å‡ºæ¥ï¼Œæˆ‘çš„å»ºè®®æ˜¯åœ¨4-6ä¹‹é—´è¿›è¡Œæµ‹è¯•ï¼Œæ™®é€šç”µè„‘å¤§æ¦‚ä¼šèŠ±è´¹3ç§’æ—¶é—´ï¼Œåœ¨è±ç‰¹å¸ä¸­éš¾åº¦å¤§æ¦‚å›´ç»•åœ¨442592å·¦å³ï¼Œè€Œåœ¨æ¯”ç‰¹å¸ä¸­æ¯ä¸€æ¬¡æŒ–çŸ¿éƒ½è¦æ±‚å¤§æ¦‚åœ¨10åˆ†é’Ÿå·¦å³ï¼Œå½“ç„¶æ ¹æ®æ‰€æœ‰ç½‘ç»œä¸­çš„è®¡ç®—èƒ½åŠ›ï¼Œéš¾åº¦ä¹Ÿä¼šä¸æ–­çš„è¿›è¡Œä¿®æ”¹ã€‚
 
æˆ‘ä»¬åœ¨`NoobChain`ç±» ä¸­å¢åŠ `difficulty`è¿™ä¸ªé™æ€å˜é‡ã€‚

```java
public static int difficulty = 5;
```

è¿™æ ·æˆ‘ä»¬å¿…é¡»ä¿®æ”¹ä¸»æ–¹æ³•ä¸­è®©åˆ›å»ºæ¯ä¸ªæ–°åŒºå—æ—¶å¿…é¡»è§¦å‘`mineBlock()`æ–¹æ³•ï¼Œè€Œ`isChainValid()`æ–¹æ³•ç”¨æ¥æ£€æŸ¥æ¯ä¸ªåŒºå—çš„hashå€¼æ˜¯å¦æ­£ç¡®ï¼Œæ•´ä¸ªåŒºå—é“¾æ˜¯å¦æ˜¯æœ‰æ•ˆçš„ã€‚

```java
import java.util.ArrayList;
import com.google.gson.GsonBuilder;

public class NoobChain {
	
	public static ArrayList<Block> blockchain = new ArrayList<Block>();
	public static int difficulty = 5;

	public static void main(String[] args) {	
		//add our blocks to the blockchain ArrayList:
		
		blockchain.add(new Block("Hi im the first block", "0"));
		System.out.println("Trying to Mine block 1... ");
		blockchain.get(0).mineBlock(difficulty);
		
		blockchain.add(new Block("Yo im the second block",blockchain.get(blockchain.size()-1).hash));
		System.out.println("Trying to Mine block 2... ");
		blockchain.get(1).mineBlock(difficulty);
		
		blockchain.add(new Block("Hey im the third block",blockchain.get(blockchain.size()-1).hash));
		System.out.println("Trying to Mine block 3... ");
		blockchain.get(2).mineBlock(difficulty);	
		
		System.out.println("\nBlockchain is Valid: " + isChainValid());
		
		String blockchainJson = new GsonBuilder().setPrettyPrinting().create().toJson(blockchain);
		System.out.println("\nThe block chain: ");
		System.out.println(blockchainJson);
	}
	
	public static Boolean isChainValid() {
		Block currentBlock; 
		Block previousBlock;
		String hashTarget = new String(new char[difficulty]).replace('\0', '0');
		
		//loop through blockchain to check hashes:
		for(int i=1; i < blockchain.size(); i++) {
			currentBlock = blockchain.get(i);
			previousBlock = blockchain.get(i-1);
			//compare registered hash and calculated hash:
			if(!currentBlock.hash.equals(currentBlock.calculateHash()) ){
				System.out.println("Current Hashes not equal");			
				return false;
			}
			//compare previous hash and registered previous hash
			if(!previousBlock.hash.equals(currentBlock.previousHash) ) {
				System.out.println("Previous Hashes not equal");
				return false;
			}
			//check if hash is solved
			if(!currentBlock.hash.substring( 0, difficulty).equals(hashTarget)) {
				System.out.println("This block hasn't been mined");
				return false;
			}
		}
		return true;
	}
}
```

æ‰“å°ï¼š
```java
Connected to the target VM, address: '127.0.0.1:61863', transport: 'socket'
Trying to Mine block 1... 
Block Mined!!! : 0000016667d4240e9c30f53015310b0ec6ce99032d7e1d66d670afc509cab082
Trying to Mine block 2... 
Block Mined!!! : 000002ea55735bea4cac7e358c7b0d8d81e8ca24021f5f85211bf54fd4ac795a
Trying to Mine block 3... 
Block Mined!!! : 000000576987e5e9afbdf19b512b2b7d0c56db0e6ca49b3a7e638177f617994b

Blockchain is Valid: true
[
  {
    "hash": "0000016667d4240e9c30f53015310b0ec6ce99032d7e1d66d670afc509cab082",
    "previousHash": "0",
    "data": "first",
    "timeStamp": 1520659506042,
    "nonce": 618139
  },
  {
    "hash": "000002ea55735bea4cac7e358c7b0d8d81e8ca24021f5f85211bf54fd4ac795a",
    "previousHash": "0000016667d4240e9c30f53015310b0ec6ce99032d7e1d66d670afc509cab082",
    "data": "second",
    "timeStamp": 1520659508825,
    "nonce": 1819877
  },
  {
    "hash": "000000576987e5e9afbdf19b512b2b7d0c56db0e6ca49b3a7e638177f617994b",
    "previousHash": "000002ea55735bea4cac7e358c7b0d8d81e8ca24021f5f85211bf54fd4ac795a",
    "data": "third",
    "timeStamp": 1520659515910,
    "nonce": 1404341
  }
]
```

ç»è¿‡æµ‹è¯•å¢åŠ ä¸€ä¸ªæ–°çš„åŒºå—å³æŒ–çŸ¿å¿…é¡»èŠ±è´¹ä¸€å®šæ—¶é—´ï¼Œå¤§æ¦‚æ˜¯3ç§’å·¦å³ï¼Œä½ å¯ä»¥æé«˜difficultyéš¾åº¦æ¥çœ‹ï¼Œå®ƒæ˜¯å¦‚ä½•å½±å“æ•°æ®éš¾é¢˜æ‰€èŠ±è´¹çš„æ—¶é—´çš„

å¦‚æœæœ‰äººåœ¨ä½ çš„åŒºå—é“¾ç³»ç»Ÿä¸­æ¶æ„ç¯¡æ”¹æ•°æ®ï¼š

1. ä»–ä»¬çš„åŒºå—é“¾æ˜¯æ— æ•ˆçš„ã€‚
2. ä»–ä»¬æ— æ³•åˆ›å»ºæ›´é•¿çš„åŒºå—é“¾
3. ç½‘ç»œä¸­è¯šå®çš„åŒºå—é“¾ä¼šåœ¨é•¿é“¾ä¸­æ›´æœ‰æ—¶é—´çš„ä¼˜åŠ¿

å› ä¸ºç¯¡æ”¹çš„åŒºå—é“¾å°†æ— æ³•èµ¶ä¸Šé•¿é“¾å’Œæœ‰æ•ˆé“¾ï¼Œé™¤éä»–ä»¬æ¯”ä½ ç½‘ç»œä¸­æ‰€æœ‰çš„èŠ‚ç‚¹æ‹¥æœ‰æ›´å¤§çš„è®¡ç®—é€Ÿåº¦ï¼Œå¯èƒ½æ˜¯æœªæ¥çš„é‡å­è®¡ç®—æœºæˆ–è€…æ˜¯å…¶ä»–ä»€ä¹ˆã€‚

## ä½ å·²ç»å®Œæˆäº†ä½ çš„åŸºæœ¬åŒºå—é“¾ï¼

[![https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/qukuai/qukuai03.png](https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/qukuai/qukuai03.png "https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/qukuai/qukuai03.png")](https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/qukuai/qukuai03.png "https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/qukuai/qukuai03.png")

ä½ çš„åŒºå—é“¾ï¼š
- æœ‰å¾ˆå¤šåŒºå—ç»„æˆç”¨æ¥å­˜å‚¨æ•°æ®
- æœ‰æ•°å­—ç­¾åè®©ä½ çš„åŒºå—é“¾é“¾æ¥åœ¨ä¸€èµ·
- éœ€è¦æŒ–çŸ¿çš„å·¥ä½œé‡è¯æ˜æ–°çš„åŒºå—
- å¯ä»¥ç”¨æ¥æ£€æŸ¥æ•°æ®æ˜¯å¦æ˜¯æœ‰æ•ˆçš„åŒæ—¶æ˜¯æœªç»ç¯¡æ”¹çš„

[![https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/qukuai/qukuai04.png](https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/qukuai/qukuai04.png "https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/qukuai/qukuai04.png")](https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/qukuai/qukuai04.png "https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/qukuai/qukuai04.png")

åŸæ–‡é“¾æ¥ï¼š[Creating Your First Blockchain with Java. Part 1.](https://medium.com/programmers-blockchain/create-simple-blockchain-java-tutorial-from-scratch-6eeed3cb03fa)



## ä»£ç ä¸‹è½½ ##
ä»æˆ‘çš„ github ä¸­ä¸‹è½½ï¼Œ[https://github.com/longfeizheng/blockchain-java](https://github.com/longfeizheng/blockchain-java)

---
[![https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/wechat/xiaochengxu.png](https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/wechat/xiaochengxu.png "https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/wechat/xiaochengxu.png")](https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/wechat/xiaochengxu.png "https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/wechat/xiaochengxu.png")

> ğŸ™‚ğŸ™‚ğŸ™‚å…³æ³¨å¾®ä¿¡å°ç¨‹åº**javaæ¶æ„å¸ˆå†ç¨‹**
ä¸Šä¸‹ç­çš„è·¯ä¸Šæ— èŠå—ï¼Ÿè¿˜åœ¨çœ‹å°è¯´ã€æ–°é—»å—ï¼Ÿä¸çŸ¥é“æ€æ ·æé«˜è‡ªå·±çš„æŠ€æœ¯å—ï¼Ÿæ¥å§è¿™é‡Œæœ‰ä½ éœ€è¦çš„javaæ¶æ„æ–‡ç« ï¼Œ1.5w+çš„javaå·¥ç¨‹å¸ˆéƒ½åœ¨çœ‹ï¼Œä½ è¿˜åœ¨ç­‰ä»€ä¹ˆï¼Ÿ